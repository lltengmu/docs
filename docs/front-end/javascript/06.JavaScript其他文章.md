# JavaScript å…¶ä»–æ–‡ç« 

> ğŸ“š æ¥æºï¼š[ç°ä»£ JavaScript æ•™ç¨‹](https://zh.javascript.info/)
>
> æ•™ç¨‹çš„å‰ä¸¤éƒ¨åˆ†æœªæ¶‰åŠçš„å…¶ä»–ä¸»é¢˜çš„å†…å®¹åˆ—è¡¨ã€‚æ­¤å¤„å‡è®¾ä½ å·²ç†Ÿæ‚‰ JavaScript åŸºç¡€çŸ¥è¯†å’Œæµè§ˆå™¨ DOM æ“ä½œã€‚

---

## ç›®å½•

- [1. Frame å’Œ window](#1-frame-å’Œ-window)
- [2. äºŒè¿›åˆ¶æ•°æ®ï¼Œæ–‡ä»¶](#2-äºŒè¿›åˆ¶æ•°æ®æ–‡ä»¶)
- [3. ç½‘ç»œè¯·æ±‚](#3-ç½‘ç»œè¯·æ±‚)
- [4. åœ¨æµè§ˆå™¨ä¸­å­˜å‚¨æ•°æ®](#4-åœ¨æµè§ˆå™¨ä¸­å­˜å‚¨æ•°æ®)
- [5. åŠ¨ç”»](#5-åŠ¨ç”»)
- [6. Web components](#6-web-components)
- [7. æ­£åˆ™è¡¨è¾¾å¼](#7-æ­£åˆ™è¡¨è¾¾å¼)

---

## 1. Frame å’Œ window

### 1.1 å¼¹çª—å’Œ window çš„æ–¹æ³•

```javascript
// æ‰“å¼€å¼¹çª—
let newWindow = window.open(url, name, params);
// params: width, height, left, top, menubar, toolbar, location, status, resizable, scrollbars

// ç¤ºä¾‹
let params = 'scrollbars=no,resizable=no,width=500,height=400';
let newWin = window.open('/', 'popup', params);

// å¼¹çª—æ–¹æ³•
newWin.close();           // å…³é—­çª—å£
newWin.closed;            // æ£€æŸ¥æ˜¯å¦å…³é—­
newWin.focus();           // èšç„¦
newWin.blur();            // å¤±ç„¦

// å¼¹çª—å¼•ç”¨çˆ¶çª—å£
window.opener;            // æ‰“å¼€æ­¤çª—å£çš„çª—å£å¼•ç”¨

// ç§»åŠ¨å’Œè°ƒæ•´å¤§å°
newWin.moveBy(x, y);
newWin.moveTo(x, y);
newWin.resizeBy(width, height);
newWin.resizeTo(width, height);
newWin.scrollBy(x, y);
newWin.scrollTo(x, y);
```

### 1.2 è·¨çª—å£é€šä¿¡

**åŒæºç­–ç•¥**ï¼š
- åè®®ã€åŸŸåã€ç«¯å£éƒ½ç›¸åŒæ‰æ˜¯åŒæº
- åŒæºçª—å£å¯ä»¥ç›¸äº’è®¿é—®

```javascript
// åŒæº iframe è®¿é—®
iframe.contentWindow          // iframe çš„ window
iframe.contentDocument        // iframe çš„ document

// ä» iframe è®¿é—®çˆ¶çª—å£
window.parent                 // çˆ¶çª—å£
window.top                    // é¡¶å±‚çª—å£

// è·¨åŸŸé€šä¿¡ - postMessage
otherWindow.postMessage(data, targetOrigin);

// æ¥æ”¶æ¶ˆæ¯
window.addEventListener('message', function(event) {
  event.source;    // å‘é€æ–¹çª—å£
  event.origin;    // å‘é€æ–¹çš„æº
  event.data;      // æ¶ˆæ¯æ•°æ®

  // éªŒè¯æ¥æº
  if (event.origin !== 'http://example.com') return;
});
```

### 1.3 ç‚¹å‡»åŠ«æŒæ”»å‡»

**æ”»å‡»åŸç†**ï¼š
å°†ç›®æ ‡ç½‘ç«™åµŒå…¥é€æ˜ iframeï¼Œè¯±éª—ç”¨æˆ·ç‚¹å‡»ã€‚

**é˜²æŠ¤æªæ–½**ï¼š

```javascript
// 1. X-Frame-Options å“åº”å¤´
// DENY - ä¸å…è®¸åµŒå…¥
// SAMEORIGIN - åªå…è®¸åŒæºåµŒå…¥
// ALLOW-FROM domain - å…è®¸æŒ‡å®šåŸŸåµŒå…¥

// 2. CSP: frame-ancestors
Content-Security-Policy: frame-ancestors 'self';

// 3. JavaScript æ£€æµ‹
if (top !== window) {
  top.location = window.location;
}

// 4. ä½¿ç”¨ sandbox å±æ€§
<iframe sandbox="allow-scripts allow-forms">
```

---

## 2. äºŒè¿›åˆ¶æ•°æ®ï¼Œæ–‡ä»¶

### 2.1 ArrayBufferï¼ŒäºŒè¿›åˆ¶æ•°ç»„

```javascript
// åˆ›å»º ArrayBufferï¼ˆåŸå§‹äºŒè¿›åˆ¶æ•°æ®ï¼‰
let buffer = new ArrayBuffer(16); // 16 å­—èŠ‚

// è§†å›¾ç±»å‹
// Uint8Array    - æ¯ä¸ªå…ƒç´  1 å­—èŠ‚ï¼Œæ— ç¬¦å·
// Uint16Array   - æ¯ä¸ªå…ƒç´  2 å­—èŠ‚ï¼Œæ— ç¬¦å·
// Uint32Array   - æ¯ä¸ªå…ƒç´  4 å­—èŠ‚ï¼Œæ— ç¬¦å·
// Int8Array     - æ¯ä¸ªå…ƒç´  1 å­—èŠ‚ï¼Œæœ‰ç¬¦å·
// Float32Array  - æ¯ä¸ªå…ƒç´  4 å­—èŠ‚ï¼Œæµ®ç‚¹æ•°
// Float64Array  - æ¯ä¸ªå…ƒç´  8 å­—èŠ‚ï¼Œæµ®ç‚¹æ•°

let view = new Uint8Array(buffer);
view[0] = 255;

// DataView - çµæ´»è¯»å†™
let dataView = new DataView(buffer);
dataView.getUint8(0);
dataView.setUint16(0, 256, true); // true = little-endian
```

### 2.2 TextDecoder å’Œ TextEncoder

```javascript
// è§£ç äºŒè¿›åˆ¶ä¸ºå­—ç¬¦ä¸²
let decoder = new TextDecoder('utf-8');
let str = decoder.decode(uint8Array);

// ç¼–ç å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶
let encoder = new TextEncoder();
let uint8Array = encoder.encode("Hello");
```

### 2.3 Blob

```javascript
// åˆ›å»º Blob
let blob = new Blob(['<html>â€¦</html>'], {type: 'text/html'});
let blob2 = new Blob([buffer, blob, str], {type: 'application/octet-stream'});

// Blob å±æ€§
blob.size;
blob.type;

// åˆ‡ç‰‡
let part = blob.slice(start, end, contentType);

// Blob URL
let url = URL.createObjectURL(blob);
// ä½¿ç”¨åé‡Šæ”¾
URL.revokeObjectURL(url);

// ä¸‹è½½ Blob
let link = document.createElement('a');
link.download = 'filename.txt';
link.href = URL.createObjectURL(blob);
link.click();

// Blob è½¬ base64
let reader = new FileReader();
reader.readAsDataURL(blob);
reader.onload = function() {
  let base64 = reader.result;
};

// å›¾ç‰‡è½¬ Blob
canvas.toBlob(function(blob) {
  // å¾—åˆ° blob
}, 'image/png');
```

### 2.4 File å’Œ FileReader

```javascript
// File ç»§æ‰¿è‡ª Blob
let file = new File(["content"], "name.txt", {type: "text/plain"});

// ä» input è·å–æ–‡ä»¶
input.files[0];

// File å±æ€§
file.name;
file.lastModified;

// FileReader
let reader = new FileReader();

// è¯»å–æ–¹æ³•
reader.readAsArrayBuffer(blob);  // è¯»å–ä¸º ArrayBuffer
reader.readAsText(blob, encoding); // è¯»å–ä¸ºæ–‡æœ¬
reader.readAsDataURL(blob);      // è¯»å–ä¸º base64 Data URL

// äº‹ä»¶
reader.onload = function() {
  let result = reader.result;
};
reader.onerror = function() {
  console.log(reader.error);
};
reader.onprogress = function(event) {
  console.log(`å·²åŠ è½½ ${event.loaded} / ${event.total}`);
};

reader.abort(); // å–æ¶ˆè¯»å–
```

---

## 3. ç½‘ç»œè¯·æ±‚

### 3.1 Fetch

```javascript
let response = await fetch(url, {
  method: 'GET', // POST, PUT, DELETE, etc.
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(data), // è¯·æ±‚ä½“
  mode: 'cors', // no-cors, same-origin
  credentials: 'same-origin', // include, omit
  cache: 'default', // no-store, reload, no-cache, force-cache
  redirect: 'follow', // manual, error
  referrer: '', // no-referrer, client
  integrity: 'sha256-...' // å­èµ„æºå®Œæ•´æ€§
});

// å“åº”å±æ€§
response.status;       // çŠ¶æ€ç 
response.ok;           // 200-299 ä¸º true
response.headers;      // å“åº”å¤´

// è¯»å–å“åº”ä½“
let text = await response.text();
let json = await response.json();
let blob = await response.blob();
let buffer = await response.arrayBuffer();
let formData = await response.formData();

// Headers æ“ä½œ
response.headers.get('Content-Type');
response.headers.has('Content-Type');
response.headers.forEach((value, name) => {});
```

### 3.2 FormData

```javascript
// åˆ›å»º FormData
let formData = new FormData(formElement);
let formData = new FormData();

// æ–¹æ³•
formData.append(name, value);
formData.append(name, blob, fileName);
formData.set(name, value);  // æ›¿æ¢å·²æœ‰å­—æ®µ
formData.delete(name);
formData.get(name);
formData.getAll(name);
formData.has(name);

// ä½¿ç”¨ Fetch å‘é€
fetch('/submit', {
  method: 'POST',
  body: formData
  // Content-Type è‡ªåŠ¨è®¾ç½®ä¸º multipart/form-data
});
```

### 3.3 Fetchï¼šä¸‹è½½è¿›åº¦

```javascript
let response = await fetch(url);

const reader = response.body.getReader();
const contentLength = +response.headers.get('Content-Length');

let receivedLength = 0;
let chunks = [];

while(true) {
  const {done, value} = await reader.read();
  if (done) break;

  chunks.push(value);
  receivedLength += value.length;

  console.log(`å·²æ¥æ”¶ ${receivedLength} / ${contentLength}`);
}

let blob = new Blob(chunks);
```

### 3.4 Fetchï¼šä¸­æ­¢è¯·æ±‚

```javascript
let controller = new AbortController();

fetch(url, {
  signal: controller.signal
}).catch(err => {
  if (err.name === 'AbortError') {
    console.log('è¯·æ±‚è¢«ä¸­æ­¢');
  }
});

// ä¸­æ­¢è¯·æ±‚
controller.abort();

// è¶…æ—¶
setTimeout(() => controller.abort(), 3000);
```

### 3.5 Fetchï¼šè·¨æºè¯·æ±‚

**CORSï¼ˆè·¨æºèµ„æºå…±äº«ï¼‰**ï¼š

```javascript
// ç®€å•è¯·æ±‚ - æ»¡è¶³ä»¥ä¸‹æ¡ä»¶
// - æ–¹æ³•ï¼šGET, POST, HEAD
// - å¤´éƒ¨ï¼šAccept, Accept-Language, Content-Language,
//         Content-Type (application/x-www-form-urlencoded, multipart/form-data, text/plain)

// æœåŠ¡å™¨å“åº”å¤´
Access-Control-Allow-Origin: * æˆ– å…·ä½“æº
Access-Control-Allow-Credentials: true
Access-Control-Expose-Headers: X-Custom-Header

// é¢„æ£€è¯·æ±‚ï¼ˆéç®€å•è¯·æ±‚ï¼‰
// æµè§ˆå™¨å…ˆå‘é€ OPTIONS è¯·æ±‚

// æœåŠ¡å™¨å“åº”é¢„æ£€è¯·æ±‚
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Methods: PUT, DELETE
Access-Control-Allow-Headers: X-Custom-Header
Access-Control-Max-Age: 86400

// æºå¸¦å‡­è¯
fetch(url, {
  credentials: 'include'
});
```

### 3.6 Fetch API

å®Œæ•´çš„ Fetch æ¥å£å‚è€ƒã€‚

### 3.7 URL å¯¹è±¡

```javascript
let url = new URL('https://example.com:8080/path?query=value#hash');

url.protocol;  // "https:"
url.host;      // "example.com:8080"
url.hostname;  // "example.com"
url.port;      // "8080"
url.pathname;  // "/path"
url.search;    // "?query=value"
url.hash;      // "#hash"
url.origin;    // "https://example.com:8080"
url.href;      // å®Œæ•´ URL

// æœç´¢å‚æ•°
url.searchParams.get('query');
url.searchParams.set('key', 'value');
url.searchParams.append('key', 'value2');
url.searchParams.delete('key');
url.searchParams.has('key');
url.searchParams.forEach((value, name) => {});

// ç¼–ç 
encodeURI(url);              // ç¼–ç å®Œæ•´ URL
encodeURIComponent(str);     // ç¼–ç  URL ç»„ä»¶
decodeURI(encodedUrl);
decodeURIComponent(encodedStr);
```

### 3.8 XMLHttpRequest

```javascript
let xhr = new XMLHttpRequest();

xhr.open(method, url, async, user, password);

// è®¾ç½®è¯·æ±‚å¤´
xhr.setRequestHeader('Content-Type', 'application/json');

// å‘é€è¯·æ±‚
xhr.send(body);

// äº‹ä»¶
xhr.onload = function() {
  if (xhr.status === 200) {
    console.log(xhr.response);
  }
};

xhr.onerror = function() {
  console.log('è¯·æ±‚å¤±è´¥');
};

xhr.onprogress = function(event) {
  if (event.lengthComputable) {
    console.log(`${event.loaded} / ${event.total}`);
  }
};

// ä¸Šä¼ è¿›åº¦
xhr.upload.onprogress = function(event) { };

// å“åº”å±æ€§
xhr.status;
xhr.statusText;
xhr.response;
xhr.responseType = 'json'; // text, arraybuffer, blob, document
xhr.responseText;
xhr.responseXML;

// è¶…æ—¶
xhr.timeout = 10000;
xhr.ontimeout = function() { };

// ä¸­æ­¢
xhr.abort();

// åŒæ­¥è¯·æ±‚ï¼ˆä¸æ¨èï¼‰
xhr.open('GET', url, false);
```

### 3.9 å¯æ¢å¤çš„æ–‡ä»¶ä¸Šä¼ 

```javascript
// åˆ†ç‰‡ä¸Šä¼ å®ç°æ€è·¯
// 1. è·å–å·²ä¸Šä¼ çš„å­—èŠ‚æ•°
let startByte = await getUploadedBytes(fileId);

// 2. å‘é€å‰©ä½™éƒ¨åˆ†
let blob = file.slice(startByte);
xhr.open('POST', '/upload');
xhr.setRequestHeader('X-File-Id', fileId);
xhr.setRequestHeader('X-Start-Byte', startByte);
xhr.send(blob);
```

### 3.10 é•¿è½®è¯¢

```javascript
async function longPoll() {
  let response = await fetch('/poll');

  if (response.status === 502) {
    // è¿æ¥è¶…æ—¶ï¼Œé‡æ–°è¿æ¥
    await longPoll();
  } else if (response.status !== 200) {
    // é”™è¯¯ï¼Œç­‰å¾…åé‡è¯•
    await new Promise(resolve => setTimeout(resolve, 1000));
    await longPoll();
  } else {
    let message = await response.text();
    // å¤„ç†æ¶ˆæ¯
    await longPoll();
  }
}

longPoll();
```

### 3.11 WebSocket

```javascript
let socket = new WebSocket('wss://example.com/socket');

// äº‹ä»¶
socket.onopen = function(event) {
  socket.send('Hello Server!');
};

socket.onmessage = function(event) {
  console.log('æ”¶åˆ°:', event.data);
};

socket.onclose = function(event) {
  if (event.wasClean) {
    console.log(`å…³é—­ï¼Œcode=${event.code} reason=${event.reason}`);
  } else {
    console.log('è¿æ¥æ–­å¼€');
  }
};

socket.onerror = function(error) {
  console.log('é”™è¯¯:', error.message);
};

// å‘é€æ•°æ®
socket.send('text message');
socket.send(new Blob(['binary data']));
socket.send(new Uint8Array([1, 2, 3]));

// å±æ€§
socket.readyState; // 0=CONNECTING, 1=OPEN, 2=CLOSING, 3=CLOSED
socket.bufferedAmount; // å¾…å‘é€çš„å­—èŠ‚æ•°

// å…³é—­è¿æ¥
socket.close(1000, 'Work complete');
```

### 3.12 Server Sent Events

```javascript
let eventSource = new EventSource('/events');

// äº‹ä»¶
eventSource.onopen = function() { };
eventSource.onerror = function() { };
eventSource.onmessage = function(event) {
  console.log(event.data);
};

// è‡ªå®šä¹‰äº‹ä»¶
eventSource.addEventListener('join', function(event) {
  console.log('join:', event.data);
});

// å…³é—­è¿æ¥
eventSource.close();

// æœåŠ¡å™¨å“åº”æ ¼å¼
// Content-Type: text/event-stream
// data: message1
// data: message2
// event: join
// data: {"userId": 1}
// id: 1
// retry: 15000
```

---

## 4. åœ¨æµè§ˆå™¨ä¸­å­˜å‚¨æ•°æ®

### 4.1 Cookieï¼Œdocument.cookie

```javascript
// è¯»å– cookie
let cookies = document.cookie; // "name=value; name2=value2"

// å†™å…¥ cookie
document.cookie = "user=John";
document.cookie = encodeURIComponent(name) + '=' + encodeURIComponent(value);

// Cookie é€‰é¡¹
document.cookie = "user=John; path=/; domain=.example.com; expires=Tue, 19 Jan 2038 03:14:07 GMT; max-age=3600; secure; samesite=strict";

// path=/    - æ•´ä¸ªç½‘ç«™å¯è§
// domain=   - å­åŸŸå¯è§
// expires=  - è¿‡æœŸæ—¶é—´
// max-age=  - ç§’æ•°åè¿‡æœŸ
// secure    - ä»… HTTPS
// samesite= - strict/lax/none
// httpOnly  - ä¸èƒ½é€šè¿‡ JS è®¿é—®ï¼ˆæœåŠ¡å™¨è®¾ç½®ï¼‰
```

### 4.2 LocalStorageï¼ŒsessionStorage

```javascript
// localStorage - æ°¸ä¹…å­˜å‚¨
localStorage.setItem('key', 'value');
localStorage.getItem('key');
localStorage.removeItem('key');
localStorage.clear();
localStorage.key(index);
localStorage.length;

// sessionStorage - ä¼šè¯å­˜å‚¨ï¼ˆæ ‡ç­¾é¡µå…³é—­åæ¸…é™¤ï¼‰
sessionStorage.setItem('key', 'value');
sessionStorage.getItem('key');

// å­˜å‚¨å¯¹è±¡
localStorage.setItem('user', JSON.stringify(user));
let user = JSON.parse(localStorage.getItem('user'));

// å­˜å‚¨äº‹ä»¶ï¼ˆè·¨æ ‡ç­¾é¡µé€šä¿¡ï¼‰
window.addEventListener('storage', function(event) {
  event.key;       // æ”¹å˜çš„é”®
  event.oldValue;  // æ—§å€¼
  event.newValue;  // æ–°å€¼
  event.url;       // å‘ç”Ÿæ”¹å˜çš„æ–‡æ¡£ URL
  event.storageArea; // localStorage æˆ– sessionStorage
});
```

### 4.3 IndexedDB

```javascript
// æ‰“å¼€æ•°æ®åº“
let request = indexedDB.open('myDB', 1);

request.onupgradeneeded = function(event) {
  let db = event.target.result;

  // åˆ›å»ºå¯¹è±¡å­˜å‚¨
  let store = db.createObjectStore('books', {keyPath: 'id', autoIncrement: true});

  // åˆ›å»ºç´¢å¼•
  store.createIndex('title', 'title', {unique: false});
};

request.onsuccess = function(event) {
  let db = event.target.result;

  // äº‹åŠ¡
  let transaction = db.transaction('books', 'readwrite');
  let store = transaction.objectStore('books');

  // æ·»åŠ æ•°æ®
  store.add({title: 'JavaScript Guide'});

  // è¯»å–æ•°æ®
  let request = store.get(1);
  request.onsuccess = function() {
    console.log(request.result);
  };

  // æ›´æ–°æ•°æ®
  store.put({id: 1, title: 'Updated Title'});

  // åˆ é™¤æ•°æ®
  store.delete(1);

  // ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢
  let index = store.index('title');
  let request = index.get('JavaScript Guide');

  // æ¸¸æ ‡éå†
  let cursorRequest = store.openCursor();
  cursorRequest.onsuccess = function(event) {
    let cursor = event.target.result;
    if (cursor) {
      console.log(cursor.value);
      cursor.continue();
    }
  };

  transaction.oncomplete = function() {
    console.log('äº‹åŠ¡å®Œæˆ');
  };
};

request.onerror = function() {
  console.log('æ‰“å¼€æ•°æ®åº“å¤±è´¥');
};

// åˆ é™¤æ•°æ®åº“
indexedDB.deleteDatabase('myDB');
```

---

## 5. åŠ¨ç”»

### 5.1 è´å¡å°”æ›²çº¿

è´å¡å°”æ›²çº¿ç”¨äºå®šä¹‰åŠ¨ç”»çš„æ—¶é—´å‡½æ•°ã€‚

```css
/* CSS ä¸­ä½¿ç”¨ */
transition-timing-function: cubic-bezier(0.25, 0.1, 0.25, 1.0);

/* é¢„è®¾å€¼ */
ease         /* cubic-bezier(0.25, 0.1, 0.25, 1.0) */
linear       /* cubic-bezier(0, 0, 1, 1) */
ease-in      /* cubic-bezier(0.42, 0, 1.0, 1.0) */
ease-out     /* cubic-bezier(0, 0, 0.58, 1.0) */
ease-in-out  /* cubic-bezier(0.42, 0, 0.58, 1.0) */
```

### 5.2 CSS åŠ¨ç”»

```css
/* transition */
.element {
  transition: property duration timing-function delay;
  transition: all 0.3s ease-in-out;
  transition: width 2s, height 2s;
}

/* @keyframes åŠ¨ç”» */
@keyframes slide {
  from { transform: translateX(0); }
  to { transform: translateX(100px); }
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-20px); }
}

.element {
  animation: name duration timing-function delay iteration-count direction fill-mode;
  animation: slide 2s ease-in-out infinite alternate;
}
```

```javascript
// JavaScript äº‹ä»¶
elem.addEventListener('transitionend', function(event) {
  event.propertyName; // å®Œæˆçš„å±æ€§
  event.elapsedTime;  // åŠ¨ç”»æŒç»­æ—¶é—´
});

elem.addEventListener('animationstart', handler);
elem.addEventListener('animationend', handler);
elem.addEventListener('animationiteration', handler);
```

### 5.3 JavaScript åŠ¨ç”»

```javascript
// requestAnimationFrame
function animate(timing, draw, duration) {
  let start = performance.now();

  requestAnimationFrame(function animate(time) {
    let timeFraction = (time - start) / duration;
    if (timeFraction > 1) timeFraction = 1;

    let progress = timing(timeFraction);
    draw(progress);

    if (timeFraction < 1) {
      requestAnimationFrame(animate);
    }
  });
}

// ä½¿ç”¨
animate(
  timeFraction => timeFraction,  // æ—¶é—´å‡½æ•°ï¼ˆçº¿æ€§ï¼‰
  progress => {
    elem.style.width = progress * 100 + '%';
  },
  1000
);

// å¸¸ç”¨æ—¶é—´å‡½æ•°
function quad(timeFraction) {
  return Math.pow(timeFraction, 2);
}

function circ(timeFraction) {
  return 1 - Math.sin(Math.acos(timeFraction));
}

function bounce(timeFraction) {
  for (let a = 0, b = 1; 1; a += b, b /= 2) {
    if (timeFraction >= (7 - 4 * a) / 11) {
      return -Math.pow((11 - 6 * a - 11 * timeFraction) / 4, 2) + Math.pow(b, 2);
    }
  }
}

// easeOut å˜æ¢
function makeEaseOut(timing) {
  return function(timeFraction) {
    return 1 - timing(1 - timeFraction);
  };
}

// easeInOut å˜æ¢
function makeEaseInOut(timing) {
  return function(timeFraction) {
    if (timeFraction < 0.5) {
      return timing(2 * timeFraction) / 2;
    } else {
      return (2 - timing(2 * (1 - timeFraction))) / 2;
    }
  };
}
```

---

## 6. Web components

### 6.1 ä»å¤–åˆ°å†…

Web Components æ˜¯ä¸€å¥—ä¸åŒçš„æŠ€æœ¯ï¼Œå…è®¸åˆ›å»ºå¯é‡ç”¨çš„å®šåˆ¶å…ƒç´ ã€‚

### 6.2 Custom elements

```javascript
// è‡ªå®šä¹‰å…ƒç´ 
class MyElement extends HTMLElement {
  constructor() {
    super();
    // å…ƒç´ åˆ›å»ºæ—¶è°ƒç”¨
  }

  connectedCallback() {
    // å…ƒç´ æ·»åŠ åˆ°æ–‡æ¡£æ—¶è°ƒç”¨
  }

  disconnectedCallback() {
    // å…ƒç´ ä»æ–‡æ¡£ç§»é™¤æ—¶è°ƒç”¨
  }

  static get observedAttributes() {
    return ['attr1', 'attr2'];
  }

  attributeChangedCallback(name, oldValue, newValue) {
    // ç‰¹æ€§æ”¹å˜æ—¶è°ƒç”¨
  }

  adoptedCallback() {
    // å…ƒç´ ç§»åŠ¨åˆ°æ–°æ–‡æ¡£æ—¶è°ƒç”¨
  }
}

// æ³¨å†Œè‡ªå®šä¹‰å…ƒç´ 
customElements.define('my-element', MyElement);

// ç­‰å¾…è‡ªå®šä¹‰å…ƒç´ å®šä¹‰
customElements.whenDefined('my-element').then(() => {});

// æ‰©å±•å†…å»ºå…ƒç´ 
class MyButton extends HTMLButtonElement {
  constructor() {
    super();
  }
}
customElements.define('my-button', MyButton, {extends: 'button'});
// ä½¿ç”¨: <button is="my-button">
```

### 6.3 Shadow DOM

```javascript
// åˆ›å»º shadow DOM
let shadow = elem.attachShadow({mode: 'open'}); // æˆ– 'closed'

shadow.innerHTML = `
  <style>
    p { color: red; }
  </style>
  <p>Shadow DOM content</p>
`;

// è®¿é—® shadow DOM
elem.shadowRoot; // å¦‚æœ mode æ˜¯ 'open'

// æ ·å¼æ’æ§½
<style>
  ::slotted(span) { color: blue; }
</style>
```

### 6.4 æ¨¡æ¿å…ƒç´ 

```html
<template id="tmpl">
  <style>
    p { font-weight: bold; }
  </style>
  <p id="message">Hello!</p>
</template>

<script>
let template = document.getElementById('tmpl');
let clone = template.content.cloneNode(true);
document.body.append(clone);
</script>
```

### 6.5 Shadow DOM æ’æ§½ï¼Œç»„æˆ

```html
<my-card>
  <span slot="title">Card Title</span>
  <p>Card content</p>
</my-card>

<template id="my-card-template">
  <style>
    .card { border: 1px solid #ccc; padding: 10px; }
  </style>
  <div class="card">
    <h2><slot name="title"></slot></h2>
    <slot></slot> <!-- é»˜è®¤æ’æ§½ -->
  </div>
</template>

<script>
class MyCard extends HTMLElement {
  constructor() {
    super();
    let shadow = this.attachShadow({mode: 'open'});
    let template = document.getElementById('my-card-template');
    shadow.append(template.content.cloneNode(true));
  }
}
customElements.define('my-card', MyCard);
</script>
```

### 6.6 Shadow DOM æ ·å¼

```javascript
// ç»„ä»¶å†…éƒ¨æ ·å¼
shadow.innerHTML = `
  <style>
    :host {
      display: block;
    }
    :host(.dark) {
      background: black;
    }
    :host-context(.dark-theme) {
      color: white;
    }
    ::slotted(span) {
      font-weight: bold;
    }
  </style>
`;

// CSS å˜é‡ç©¿é€ shadow DOM
<style>
  my-element {
    --text-color: blue;
  }
</style>

// åœ¨ shadow DOM ä¸­ä½¿ç”¨
<style>
  p {
    color: var(--text-color, black);
  }
</style>
```

### 6.7 Shadow DOM å’Œäº‹ä»¶

```javascript
// äº‹ä»¶é‡å®šå‘
// ä» shadow DOM å†…éƒ¨è§¦å‘çš„äº‹ä»¶ï¼Œtarget ä¼šé‡å®šå‘åˆ°å®¿ä¸»å…ƒç´ 

// composed äº‹ä»¶å¯ä»¥ç©¿é€ shadow DOM
elem.dispatchEvent(new CustomEvent('my-event', {
  bubbles: true,
  composed: true,  // å¯ä»¥ç©¿é€ shadow DOM
  detail: { data: 'value' }
}));
```

---

## 7. æ­£åˆ™è¡¨è¾¾å¼

### 7.1 æ¨¡å¼ï¼ˆpatternï¼‰å’Œä¿®é¥°ç¬¦ï¼ˆflagsï¼‰

```javascript
// åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼
let regexp = /pattern/flags;
let regexp = new RegExp('pattern', 'flags');

// ä¿®é¥°ç¬¦
// i - ä¸åŒºåˆ†å¤§å°å†™
// g - å…¨å±€æœç´¢
// m - å¤šè¡Œæ¨¡å¼
// s - dotall æ¨¡å¼ï¼Œ. åŒ¹é…æ¢è¡Œç¬¦
// u - Unicode æ¨¡å¼
// y - ç²˜è¿æ¨¡å¼
```

### 7.2 å­—ç¬¦ç±»

```javascript
\d  // æ•°å­— [0-9]
\D  // éæ•°å­— [^0-9]
\w  // å•è¯å­—ç¬¦ [a-zA-Z0-9_]
\W  // éå•è¯å­—ç¬¦
\s  // ç©ºç™½å­—ç¬¦ [ \t\n\r\f]
\S  // éç©ºç™½å­—ç¬¦
.   // ä»»æ„å­—ç¬¦ï¼ˆé™¤æ¢è¡Œç¬¦å¤–ï¼Œé™¤éä½¿ç”¨ s æ ‡å¿—ï¼‰
```

### 7.3 Unicodeï¼šä¿®é¥°ç¬¦ "u" å’Œç±» \p{...}

```javascript
// Unicode å±æ€§
/\p{Letter}/u        // ä»»ä½•è¯­è¨€çš„å­—æ¯
/\p{Number}/u        // æ•°å­—
/\p{Sc}/u            // è´§å¸ç¬¦å·
/\p{Script=Greek}/u  // å¸Œè…Šå­—æ¯
```

### 7.4 é”šç‚¹ï¼šå­—ç¬¦ä¸²å¼€å§‹ ^ å’Œç»“æŸ $

```javascript
/^start/    // åŒ¹é…å¼€å¤´
/end$/      // åŒ¹é…ç»“å°¾
/^exact$/   // ç²¾ç¡®åŒ¹é…

// å¤šè¡Œæ¨¡å¼
/^line/m    // åŒ¹é…æ¯è¡Œå¼€å¤´
```

### 7.5 é”šç‚¹ ^ $ çš„å¤šè¡Œæ¨¡å¼

```javascript
let str = `1st line
2nd line
3rd line`;

str.match(/^\d/gm);  // ["1", "2", "3"]
```

### 7.6 è¯è¾¹ç•Œï¼š\b

```javascript
/\bword\b/   // åŒ¹é…å®Œæ•´å•è¯
/\bJava\b/   // åŒ¹é… "Java" ä½†ä¸åŒ¹é… "JavaScript"
```

### 7.7 è½¬ä¹‰ï¼Œç‰¹æ®Šå­—ç¬¦

```javascript
// éœ€è¦è½¬ä¹‰çš„ç‰¹æ®Šå­—ç¬¦
// [ ] \ ^ $ . | ? * + ( ) { }

/\[/   // åŒ¹é… [
/\./   // åŒ¹é… .
/\\/   // åŒ¹é… \

// åœ¨ new RegExp() ä¸­éœ€è¦åŒé‡è½¬ä¹‰
new RegExp('\\d+');
```

### 7.8 é›†åˆå’ŒèŒƒå›´ [...]

```javascript
[abc]     // a æˆ– b æˆ– c
[a-z]     // a åˆ° z
[0-9]     // 0 åˆ° 9
[a-zA-Z]  // æ‰€æœ‰å­—æ¯
[^abc]    // é™¤äº† a, b, c ä»¥å¤–çš„å­—ç¬¦
```

### 7.9 é‡è¯ +, *, ? å’Œ {n}

```javascript
a?      // 0 æˆ– 1 ä¸ª
a*      // 0 æˆ–å¤šä¸ª
a+      // 1 æˆ–å¤šä¸ª
a{3}    // æ°å¥½ 3 ä¸ª
a{3,}   // è‡³å°‘ 3 ä¸ª
a{3,5}  // 3 åˆ° 5 ä¸ª
```

### 7.10 è´ªå©ªé‡è¯å’Œæƒ°æ€§é‡è¯

```javascript
// è´ªå©ªæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰- å°½å¯èƒ½å¤šåŒ¹é…
/".*"/g   // åŒ¹é… "a" "b" ä¸­çš„ "a" "b"

// æƒ°æ€§æ¨¡å¼ - å°½å¯èƒ½å°‘åŒ¹é…
/".*?"/g  // åŒ¹é… "a" "b" ä¸­çš„ "a" å’Œ "b"

// æƒ°æ€§é‡è¯
+?  *?  ??  {n,m}?
```

### 7.11 æ•è·ç»„

```javascript
// åŸºæœ¬æ•è·ç»„
/(go)+/   // åŒ¹é… "go", "gogo", "gogogo"...

let match = 'gogogo'.match(/(go)+/);
match[0]  // "gogogo" - å®Œæ•´åŒ¹é…
match[1]  // "go" - æ•è·ç»„å†…å®¹

// å‘½åæ•è·ç»„
/(?<year>\d{4})-(?<month>\d{2})/

let match = '2024-01'.match(/(?<year>\d{4})-(?<month>\d{2})/);
match.groups.year   // "2024"
match.groups.month  // "01"

// éæ•è·ç»„
/(?:go)+/   // åˆ†ç»„ä½†ä¸æ•è·
```

### 7.12 åå‘å¼•ç”¨ï¼š\N å’Œ \k<name>

```javascript
// æ•°å­—å¼•ç”¨
/(['"])(.*?)\1/   // åŒ¹é… 'text' æˆ– "text"

// å‘½åå¼•ç”¨
/(?<quote>['"])(.*?)\k<quote>/
```

### 7.13 é€‰æ‹©ï¼ˆORï¼‰|

```javascript
/html|css|js/   // åŒ¹é… html æˆ– css æˆ– js
/(html|css|js) file/   // åŒ¹é… "html file", "css file", "js file"
```

### 7.14 å‰ç»æ–­è¨€ä¸åç»æ–­è¨€

```javascript
// å‰ç»æ–­è¨€
/x(?=y)/   // x åé¢è·Ÿç€ y
/x(?!y)/   // x åé¢ä¸è·Ÿç€ y

// åç»æ–­è¨€
/(?<=y)x/  // x å‰é¢æ˜¯ y
/(?<!y)x/  // x å‰é¢ä¸æ˜¯ y

// ç¤ºä¾‹
/\d+(?= dollars)/   // åŒ¹é… "100" åœ¨ "100 dollars" ä¸­
/\d+(?! dollars)/   // åŒ¹é… "100" åœ¨ "100 euros" ä¸­
```

### 7.15 ç¾éš¾æ€§å›æº¯

```javascript
// å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜çš„æ¨¡å¼
/^(\w+)*$/   // å¯¹äºç‰¹å®šè¾“å…¥ä¼šå¾ˆæ…¢

// è§£å†³æ–¹æ¡ˆ
// 1. ä½¿ç”¨åŸå­ç»„ï¼ˆä¸æ”¯æŒï¼‰
// 2. ä½¿ç”¨æ›´ç²¾ç¡®çš„æ¨¡å¼
// 3. ä½¿ç”¨ possessive é‡è¯ï¼ˆä¸æ”¯æŒï¼‰
```

### 7.16 ç²˜æ€§æ ‡å¿— "y"ï¼Œåœ¨ä½ç½®å¤„æœç´¢

```javascript
let regexp = /\w+/y;
regexp.lastIndex = 5;

let str = "Hello World";
regexp.exec(str);   // ä»ä½ç½® 5 å¼€å§‹åŒ¹é…
```

### 7.17 æ­£åˆ™è¡¨è¾¾å¼å’Œå­—ç¬¦ä¸²çš„æ–¹æ³•

```javascript
// String æ–¹æ³•
str.match(regexp);      // æŸ¥æ‰¾åŒ¹é…
str.matchAll(regexp);   // æ‰€æœ‰åŒ¹é…çš„è¿­ä»£å™¨
str.replace(regexp, replacement);  // æ›¿æ¢
str.replaceAll(regexp, replacement); // å…¨éƒ¨æ›¿æ¢
str.search(regexp);     // æŸ¥æ‰¾ä½ç½®
str.split(regexp);      // åˆ†å‰²

// RegExp æ–¹æ³•
regexp.exec(str);       // æ‰§è¡Œæœç´¢
regexp.test(str);       // æµ‹è¯•æ˜¯å¦åŒ¹é…

// replace æ›¿æ¢æ¨¡å¼
$&    // åŒ¹é…çš„å­ä¸²
$`    // åŒ¹é…ä¹‹å‰çš„å†…å®¹
$'    // åŒ¹é…ä¹‹åçš„å†…å®¹
$n    // ç¬¬ n ä¸ªæ•è·ç»„
$<name>  // å‘½åæ•è·ç»„

// replace å›è°ƒå‡½æ•°
str.replace(/(\w+)/g, (match, p1, offset, string) => {
  return match.toUpperCase();
});
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [ç°ä»£ JavaScript æ•™ç¨‹ - å…¶ä»–æ–‡ç« ](https://zh.javascript.info/ui)
- [MDN Web APIs](https://developer.mozilla.org/zh-CN/docs/Web/API)
- [æ­£åˆ™è¡¨è¾¾å¼å‚è€ƒ](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions)

