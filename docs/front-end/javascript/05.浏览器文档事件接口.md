# æµè§ˆå™¨ï¼šæ–‡æ¡£ï¼Œäº‹ä»¶ï¼Œæ¥å£

> ğŸ“š æ¥æºï¼š[ç°ä»£ JavaScript æ•™ç¨‹](https://zh.javascript.info/)
>
> å­¦ä¹ å¦‚ä½•ç®¡ç†æµè§ˆå™¨é¡µé¢ï¼šæ·»åŠ å…ƒç´ ï¼Œæ“çºµå…ƒç´ çš„å¤§å°å’Œä½ç½®ï¼ŒåŠ¨æ€åˆ›å»ºæ¥å£å¹¶ä¸è®¿é—®è€…äº’åŠ¨ã€‚

---

## ç›®å½•

- [1. Document](#1-document)
- [2. äº‹ä»¶ç®€ä»‹](#2-äº‹ä»¶ç®€ä»‹)
- [3. UI äº‹ä»¶](#3-ui-äº‹ä»¶)
- [4. è¡¨å•ï¼Œæ§ä»¶](#4-è¡¨å•æ§ä»¶)
- [5. åŠ è½½æ–‡æ¡£å’Œå…¶ä»–èµ„æº](#5-åŠ è½½æ–‡æ¡£å’Œå…¶ä»–èµ„æº)
- [6. æ‚é¡¹](#6-æ‚é¡¹)

---

## 1. Document

### 1.1 æµè§ˆå™¨ç¯å¢ƒï¼Œè§„æ ¼

**JavaScript å®¿ä¸»ç¯å¢ƒæ¶æ„**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      window                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    DOM    â”‚  â”‚    BOM    â”‚  â”‚   JavaScript    â”‚  â”‚
â”‚  â”‚ document  â”‚  â”‚ navigator â”‚  â”‚     Object      â”‚  â”‚
â”‚  â”‚           â”‚  â”‚  screen   â”‚  â”‚     Array       â”‚  â”‚
â”‚  â”‚           â”‚  â”‚ location  â”‚  â”‚     Function    â”‚  â”‚
â”‚  â”‚           â”‚  â”‚  fetch    â”‚  â”‚      ...        â”‚  â”‚
â”‚  â”‚           â”‚  â”‚  history  â”‚  â”‚                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **DOM (Document Object Model)**ï¼šå°†é¡µé¢å†…å®¹è¡¨ç¤ºä¸ºå¯ä¿®æ”¹çš„å¯¹è±¡
- **BOM (Browser Object Model)**ï¼šæµè§ˆå™¨æä¾›çš„ç”¨äºä¸æ–‡æ¡£ä¹‹å¤–çš„ä¸œè¥¿è¿›è¡Œäº¤äº’çš„å¯¹è±¡
- **JavaScript**ï¼šæ ¸å¿ƒè¯­è¨€

### 1.2 DOM æ ‘

æ¯ä¸ª HTML æ ‡ç­¾éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚æ ‡ç­¾å†…çš„æ–‡æœ¬ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚

```html
<!DOCTYPE html>
<html>
<head>
  <title>About elk</title>
</head>
<body>
  The truth about elk.
</body>
</html>
```

å¯¹åº”çš„ DOM æ ‘ç»“æ„ï¼š

```
â”Œâ”€ DOCTYPE: html
â””â”€ HTML
   â”œâ”€ HEAD
   â”‚  â”œâ”€ #text â†µâ£â£
   â”‚  â”œâ”€ TITLE
   â”‚  â”‚  â””â”€ #text About elk
   â”‚  â””â”€ #text â†µ
   â””â”€ BODY
      â””â”€ #text The truth about elk.
```

**èŠ‚ç‚¹ç±»å‹**ï¼š
- å…ƒç´ èŠ‚ç‚¹ï¼ˆElement nodesï¼‰
- æ–‡æœ¬èŠ‚ç‚¹ï¼ˆText nodesï¼‰
- æ³¨é‡ŠèŠ‚ç‚¹ï¼ˆComment nodesï¼‰

### 1.3 éå† DOM

**DOM èŠ‚ç‚¹å¯¼èˆªå±æ€§**ï¼š

```javascript
// æ‰€æœ‰èŠ‚ç‚¹
node.parentNode     // çˆ¶èŠ‚ç‚¹
node.childNodes     // å­èŠ‚ç‚¹é›†åˆ
node.firstChild     // ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹
node.lastChild      // æœ€åä¸€ä¸ªå­èŠ‚ç‚¹
node.previousSibling // å‰ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹
node.nextSibling    // åä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹

// ä»…å…ƒç´ èŠ‚ç‚¹
node.parentElement
node.children
node.firstElementChild
node.lastElementChild
node.previousElementSibling
node.nextElementSibling
```

**ç‰¹æ®Šçš„ DOM å±æ€§**ï¼š
```javascript
document.documentElement // <html>
document.body            // <body>
document.head            // <head>
```

### 1.4 æœç´¢ï¼šgetElement*ï¼ŒquerySelector*

```javascript
// é€šè¿‡ id è·å–
document.getElementById('elem');
// ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ id å˜é‡ï¼ˆä¸æ¨èï¼‰

// é€šè¿‡é€‰æ‹©å™¨è·å–
document.querySelector('div.menu');        // ç¬¬ä¸€ä¸ªåŒ¹é…
document.querySelectorAll('div.menu');     // æ‰€æœ‰åŒ¹é…

// é€šè¿‡ç±»åã€æ ‡ç­¾åè·å–
document.getElementsByClassName('menu');
document.getElementsByTagName('div');

// é€šè¿‡ name å±æ€§è·å–
document.getElementsByName('age');

// å…ƒç´ ä¸Šçš„æ–¹æ³•
elem.querySelector('selector');
elem.querySelectorAll('selector');

// æ£€æŸ¥åŒ¹é…
elem.matches('selector');    // æ˜¯å¦åŒ¹é…é€‰æ‹©å™¨
elem.closest('selector');    // æœ€è¿‘çš„ç¥–å…ˆå…ƒç´ 
```

### 1.5 èŠ‚ç‚¹å±æ€§ï¼štypeï¼Œtag å’Œ content

**DOM èŠ‚ç‚¹ç±»**çš„ç»§æ‰¿å±‚æ¬¡ï¼š
```
EventTarget
    â””â”€â”€ Node
        â”œâ”€â”€ Text
        â”œâ”€â”€ Comment
        â””â”€â”€ Element
            â””â”€â”€ HTMLElement
                â”œâ”€â”€ HTMLInputElement
                â”œâ”€â”€ HTMLBodyElement
                â”œâ”€â”€ HTMLAnchorElement
                â””â”€â”€ ...
```

**é‡è¦å±æ€§**ï¼š
```javascript
elem.nodeType     // 1=å…ƒç´ , 3=æ–‡æœ¬, 8=æ³¨é‡Š, 9=document
elem.nodeName     // èŠ‚ç‚¹åï¼ˆæ ‡ç­¾åï¼‰
elem.tagName      // æ ‡ç­¾åï¼ˆä»…å…ƒç´ èŠ‚ç‚¹æœ‰ï¼‰

// å†…å®¹
elem.innerHTML    // å…ƒç´ çš„ HTML å†…å®¹
elem.outerHTML    // åŒ…å«å…ƒç´ è‡ªèº«çš„ HTML
elem.textContent  // å…ƒç´ çš„æ–‡æœ¬å†…å®¹
elem.data         // æ–‡æœ¬/æ³¨é‡ŠèŠ‚ç‚¹çš„å†…å®¹

// éšè—
elem.hidden = true;
```

### 1.6 ç‰¹æ€§å’Œå±æ€§

**DOM å±æ€§**ï¼š
```javascript
document.body.myData = { name: 'John' };
alert(document.body.myData.name); // John

document.body.sayTagName = function() {
  alert(this.tagName);
};
document.body.sayTagName(); // BODY
```

**HTML ç‰¹æ€§**ï¼š
```javascript
elem.hasAttribute(name)     // æ£€æŸ¥æ˜¯å¦å­˜åœ¨
elem.getAttribute(name)     // è·å–å€¼
elem.setAttribute(name, value) // è®¾ç½®å€¼
elem.removeAttribute(name)  // ç§»é™¤
elem.attributes             // æ‰€æœ‰ç‰¹æ€§çš„é›†åˆ
```

**ç‰¹æ€§ä¸å±æ€§çš„åŒæ­¥**ï¼š
- æ ‡å‡†ç‰¹æ€§ä¼šè‡ªåŠ¨åŒæ­¥ä¸º DOM å±æ€§
- éæ ‡å‡†ç‰¹æ€§éœ€è¦ä½¿ç”¨ `getAttribute`

**data-* ç‰¹æ€§**ï¼š
```html
<div data-about="Elephants" data-order-state="new"></div>
```

```javascript
elem.dataset.about       // "Elephants"
elem.dataset.orderState  // "new"
```

### 1.7 ä¿®æ”¹æ–‡æ¡£

**åˆ›å»ºå…ƒç´ **ï¼š
```javascript
let div = document.createElement('div');
let textNode = document.createTextNode('Hello');
```

**æ’å…¥å…ƒç´ **ï¼š
```javascript
// æ’å…¥å­èŠ‚ç‚¹
node.append(...nodes)       // æœ«å°¾æ’å…¥
node.prepend(...nodes)      // å¼€å¤´æ’å…¥
node.before(...nodes)       // å‰é¢æ’å…¥
node.after(...nodes)        // åé¢æ’å…¥
node.replaceWith(...nodes)  // æ›¿æ¢

// æ’å…¥ HTML
elem.insertAdjacentHTML(where, html);
// where: 'beforebegin', 'afterbegin', 'beforeend', 'afterend'
```

**ç§»é™¤å’Œå…‹éš†**ï¼š
```javascript
node.remove();              // ç§»é™¤èŠ‚ç‚¹
elem.cloneNode(true);       // æ·±åº¦å…‹éš†
elem.cloneNode(false);      // æµ…å…‹éš†
```

**DocumentFragment**ï¼š
```javascript
let fragment = new DocumentFragment();
// æ·»åŠ èŠ‚ç‚¹åˆ° fragment
parent.append(fragment); // fragment çš„å†…å®¹è¢«æ’å…¥ï¼Œfragment å˜ç©º
```

**æ—§å¼æ–¹æ³•ï¼ˆä¸æ¨èï¼‰**ï¼š
```javascript
parent.appendChild(node)
parent.insertBefore(node, nextSibling)
parent.removeChild(node)
parent.replaceChild(newNode, oldNode)
document.write(html)
```

### 1.8 æ ·å¼å’Œç±»

**className å’Œ classList**ï¼š
```javascript
elem.className = 'my-class other-class';

elem.classList.add('class');
elem.classList.remove('class');
elem.classList.toggle('class');
elem.classList.contains('class');
```

**å…ƒç´ æ ·å¼**ï¼š
```javascript
elem.style.width = '100px';
elem.style.backgroundColor = 'red';
elem.style.cssText = 'color: red; width: 100px';

// è·å–è®¡ç®—åçš„æ ·å¼
getComputedStyle(elem).width;
```

### 1.9 å…ƒç´ å¤§å°å’Œæ»šåŠ¨

**å‡ ä½•å±æ€§**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                offsetParent               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ offsetLeft/Top                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ border                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ padding                 â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ content           â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ clientWidth/Heightâ”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ scrollWidth/Heightâ”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  offsetWidth/Height           â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
elem.offsetParent   // æœ€è¿‘çš„å®šä½ç¥–å…ˆ
elem.offsetLeft/Top // ç›¸å¯¹äº offsetParent çš„åç§»
elem.offsetWidth/Height // å…ƒç´ å®Œæ•´å®½é«˜ï¼ˆå«è¾¹æ¡†ï¼‰
elem.clientLeft/Top // è¾¹æ¡†å®½åº¦
elem.clientWidth/Height // å†…å®¹åŒº+å†…è¾¹è·
elem.scrollWidth/Height // å†…å®¹å®Œæ•´å®½é«˜ï¼ˆå«æº¢å‡ºï¼‰
elem.scrollLeft/Top // æ»šåŠ¨è·ç¦»
```

### 1.10 Window å¤§å°å’Œæ»šåŠ¨

```javascript
// çª—å£å¤§å°
document.documentElement.clientWidth  // çª—å£å®½åº¦ï¼ˆä¸å«æ»šåŠ¨æ¡ï¼‰
document.documentElement.clientHeight // çª—å£é«˜åº¦
window.innerWidth/Height              // çª—å£å®½é«˜ï¼ˆå«æ»šåŠ¨æ¡ï¼‰

// æ–‡æ¡£å¤§å°
let scrollHeight = Math.max(
  document.body.scrollHeight, document.documentElement.scrollHeight,
  document.body.offsetHeight, document.documentElement.offsetHeight,
  document.body.clientHeight, document.documentElement.clientHeight
);

// æ»šåŠ¨
window.pageXOffset / window.scrollX   // æ°´å¹³æ»šåŠ¨
window.pageYOffset / window.scrollY   // å‚ç›´æ»šåŠ¨

// æ»šåŠ¨æ–¹æ³•
window.scrollTo(x, y);
window.scrollBy(x, y);
elem.scrollIntoView(top);
```

### 1.11 åæ ‡

```javascript
// ç›¸å¯¹äºçª—å£çš„åæ ‡
elem.getBoundingClientRect();
// è¿”å›: { x, y, width, height, top, right, bottom, left }

// è·å–åæ ‡å¤„çš„å…ƒç´ 
document.elementFromPoint(x, y);
```

---

## 2. äº‹ä»¶ç®€ä»‹

### 2.1 æµè§ˆå™¨äº‹ä»¶ç®€ä»‹

**å¸¸ç”¨äº‹ä»¶**ï¼š

| ç±»å‹ | äº‹ä»¶ |
|------|------|
| é¼ æ ‡ | `click`, `contextmenu`, `mouseover`, `mouseout`, `mousedown`, `mouseup`, `mousemove` |
| é”®ç›˜ | `keydown`, `keyup` |
| è¡¨å• | `submit`, `focus`, `blur`, `change`, `input` |
| æ–‡æ¡£ | `DOMContentLoaded` |
| CSS | `transitionend` |

**æ·»åŠ äº‹ä»¶å¤„ç†**ï¼š

```javascript
// 1. HTML ç‰¹æ€§ï¼ˆä¸æ¨èï¼‰
<button onclick="alert('Click!')">

// 2. DOM å±æ€§
elem.onclick = function() { };

// 3. addEventListenerï¼ˆæ¨èï¼‰
elem.addEventListener('click', handler);
elem.removeEventListener('click', handler);

// å¸¦é€‰é¡¹çš„äº‹ä»¶ç›‘å¬
elem.addEventListener('click', handler, {
  once: true,      // åªè§¦å‘ä¸€æ¬¡
  capture: true,   // æ•è·é˜¶æ®µè§¦å‘
  passive: true    // ä¸ä¼šè°ƒç”¨ preventDefault()
});
```

**äº‹ä»¶å¯¹è±¡**ï¼š
```javascript
elem.onclick = function(event) {
  event.type           // äº‹ä»¶ç±»å‹
  event.currentTarget  // å¤„ç†äº‹ä»¶çš„å…ƒç´ 
  event.target         // å®é™…è§¦å‘äº‹ä»¶çš„å…ƒç´ 
  event.clientX/Y      // é¼ æ ‡ç›¸å¯¹çª—å£çš„åæ ‡
  event.eventPhase     // å½“å‰é˜¶æ®µ
};
```

### 2.2 å†’æ³¡å’Œæ•è·

**äº‹ä»¶ä¼ æ’­çš„ä¸‰ä¸ªé˜¶æ®µ**ï¼š
1. **æ•è·é˜¶æ®µ**ï¼šäº‹ä»¶ä» Window å‘ä¸‹ä¼ æ’­åˆ°ç›®æ ‡å…ƒç´ 
2. **ç›®æ ‡é˜¶æ®µ**ï¼šäº‹ä»¶åˆ°è¾¾ç›®æ ‡å…ƒç´ 
3. **å†’æ³¡é˜¶æ®µ**ï¼šäº‹ä»¶ä»å…ƒç´ å‘ä¸Šä¼ æ’­

```javascript
// åœæ­¢å†’æ³¡
event.stopPropagation();

// åœæ­¢å†’æ³¡å¹¶é˜»æ­¢å½“å‰å…ƒç´ çš„å…¶ä»–å¤„ç†ç¨‹åº
event.stopImmediatePropagation();
```

### 2.3 äº‹ä»¶å§”æ‰˜

åˆ©ç”¨å†’æ³¡æœºåˆ¶ï¼Œåœ¨çˆ¶å…ƒç´ ä¸Šå¤„ç†å­å…ƒç´ çš„äº‹ä»¶ï¼š

```javascript
table.onclick = function(event) {
  let td = event.target.closest('td');
  if (!td) return;
  if (!table.contains(td)) return;
  highlight(td);
};
```

**è¡Œä¸ºæ¨¡å¼**ï¼šä½¿ç”¨ data-* ç‰¹æ€§å£°æ˜è¡Œä¸º

```html
<button data-toggle-id="menu">Toggle Menu</button>
<div id="menu" hidden>Menu content</div>

<script>
document.addEventListener('click', function(event) {
  let id = event.target.dataset.toggleId;
  if (!id) return;
  let elem = document.getElementById(id);
  elem.hidden = !elem.hidden;
});
</script>
```

### 2.4 æµè§ˆå™¨é»˜è®¤è¡Œä¸º

```javascript
// é˜»æ­¢é»˜è®¤è¡Œä¸º
event.preventDefault();

// æˆ–åœ¨å¤„ç†ç¨‹åºä¸­è¿”å› falseï¼ˆä»…å¯¹ on<event> æœ‰æ•ˆï¼‰
elem.onclick = function(event) {
  return false;
};

// æ£€æŸ¥é»˜è®¤è¡Œä¸ºæ˜¯å¦è¢«é˜»æ­¢
if (event.defaultPrevented) { }
```

### 2.5 åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶

```javascript
// åˆ›å»ºäº‹ä»¶
let event = new Event('build');
let event = new CustomEvent('build', {
  detail: { name: 'Custom' },
  bubbles: true,
  cancelable: true
});

// è§¦å‘äº‹ä»¶
elem.dispatchEvent(event);

// æ£€æŸ¥æ˜¯å¦è¢«å–æ¶ˆ
if (!elem.dispatchEvent(event)) {
  alert('é»˜è®¤è¡Œä¸ºè¢«å–æ¶ˆ');
}
```

---

## 3. UI äº‹ä»¶

### 3.1 é¼ æ ‡äº‹ä»¶

**é¼ æ ‡äº‹ä»¶ç±»å‹**ï¼š
```javascript
// ç®€å•äº‹ä»¶
mousedown/mouseup  // æŒ‰ä¸‹/é‡Šæ”¾é¼ æ ‡æŒ‰é’®
mouseover/mouseout // ç§»å…¥/ç§»å‡ºå…ƒç´ 
mousemove          // ç§»åŠ¨é¼ æ ‡
contextmenu        // å³é”®èœå•

// å¤æ‚äº‹ä»¶
click              // mousedown + mouseup
dblclick           // åŒå‡»
```

**äº‹ä»¶å±æ€§**ï¼š
```javascript
event.button       // 0=å·¦é”®, 1=ä¸­é”®, 2=å³é”®
event.buttons      // å½“å‰æŒ‰ä¸‹çš„æ‰€æœ‰æŒ‰é’®
event.shiftKey     // Shift æ˜¯å¦æŒ‰ä¸‹
event.ctrlKey      // Ctrl æ˜¯å¦æŒ‰ä¸‹
event.altKey       // Alt æ˜¯å¦æŒ‰ä¸‹
event.metaKey      // Cmd(Mac)/Win æ˜¯å¦æŒ‰ä¸‹
event.clientX/Y    // çª—å£åæ ‡
event.pageX/Y      // æ–‡æ¡£åæ ‡
```

### 3.2 ç§»åŠ¨é¼ æ ‡ï¼šmouseover/outï¼Œmouseenter/leave

```javascript
// mouseover/mouseout - ä¼šå†’æ³¡ï¼Œæœ‰ relatedTarget
elem.onmouseover = function(event) {
  event.target        // è¿›å…¥çš„å…ƒç´ 
  event.relatedTarget // ç¦»å¼€çš„å…ƒç´ 
};

// mouseenter/mouseleave - ä¸å†’æ³¡
elem.onmouseenter = function() { };
elem.onmouseleave = function() { };
```

### 3.3 é¼ æ ‡æ‹–æ”¾äº‹ä»¶

```javascript
// åŸç”Ÿæ‹–æ”¾ API
elem.ondragstart = function(event) {
  event.dataTransfer.setData('text/plain', data);
};

elem.ondragover = function(event) {
  event.preventDefault(); // å…è®¸æ”¾ç½®
};

elem.ondrop = function(event) {
  let data = event.dataTransfer.getData('text/plain');
};
```

**æ‰‹åŠ¨å®ç°æ‹–æ”¾**ï¼š
```javascript
ball.onmousedown = function(event) {
  let shiftX = event.clientX - ball.getBoundingClientRect().left;
  let shiftY = event.clientY - ball.getBoundingClientRect().top;

  document.onmousemove = function(event) {
    ball.style.left = event.pageX - shiftX + 'px';
    ball.style.top = event.pageY - shiftY + 'px';
  };

  document.onmouseup = function() {
    document.onmousemove = null;
    document.onmouseup = null;
  };
};

ball.ondragstart = function() {
  return false; // ç¦ç”¨åŸç”Ÿæ‹–æ”¾
};
```

### 3.4 æŒ‡é’ˆäº‹ä»¶

æŒ‡é’ˆäº‹ä»¶æ˜¯æ›´é€šç”¨çš„è¾“å…¥äº‹ä»¶ï¼Œæ¶µç›–é¼ æ ‡ã€è§¦æ‘¸å’Œè§¦æ§ç¬”ï¼š

```javascript
// æŒ‡é’ˆäº‹ä»¶
pointerdown/pointerup
pointermove
pointerover/pointerout
pointerenter/pointerleave
pointercancel
gotpointercapture/lostpointercapture

// äº‹ä»¶å±æ€§
event.pointerId    // å”¯ä¸€æ ‡è¯†ç¬¦
event.pointerType  // "mouse", "pen", "touch"
event.isPrimary    // æ˜¯å¦ä¸ºä¸»æŒ‡é’ˆ
event.width/height // æ¥è§¦åŒºåŸŸå¤§å°
event.pressure     // å‹åŠ›å€¼
```

**æŒ‡é’ˆæ•è·**ï¼š
```javascript
elem.setPointerCapture(pointerId);   // æ•è·
elem.releasePointerCapture(pointerId); // é‡Šæ”¾
```

### 3.5 é”®ç›˜ï¼škeydown å’Œ keyup

```javascript
document.onkeydown = function(event) {
  event.code     // ç‰©ç†æŒ‰é”®ä»£ç ï¼Œå¦‚ "KeyA", "ArrowLeft"
  event.key      // æŒ‰é”®å­—ç¬¦ï¼Œå¦‚ "a", "A", "ArrowLeft"
  event.repeat   // æ˜¯å¦é•¿æŒ‰é‡å¤
};
```

### 3.6 æ»šåŠ¨

```javascript
window.onscroll = function() {
  // æ»šåŠ¨å¤„ç†
};

// é˜»æ­¢æ»šåŠ¨
// æ— æ³•ç›´æ¥é˜»æ­¢ scroll äº‹ä»¶ï¼Œåº”åœ¨ wheel/keydown ç­‰äº‹ä»¶ä¸­é˜»æ­¢
elem.onwheel = function(event) {
  event.preventDefault();
};
```

---

## 4. è¡¨å•ï¼Œæ§ä»¶

### 4.1 è¡¨å•å±æ€§å’Œæ–¹æ³•

```javascript
// è·å–è¡¨å•
document.forms.myForm;
document.forms[0];

// è·å–è¡¨å•å…ƒç´ 
form.elements.login;
form.elements[0];
form.elements['user.name']; // å¸¦ç‚¹çš„åç§°

// ç®€å†™
form.login;

// è¡¨å•å…ƒç´ å±æ€§
input.value
input.checked
textarea.value
select.value
select.selectedIndex
select.options
```

### 4.2 èšç„¦ï¼šfocus/blur

```javascript
elem.focus();  // èšç„¦
elem.blur();   // å¤±ç„¦

// äº‹ä»¶
elem.onfocus = function() { };
elem.onblur = function() { };

// ä½¿ç”¨ focusin/focusout å®ç°å†’æ³¡
elem.addEventListener('focusin', handler);

// tabindex å±æ€§æ§åˆ¶ Tab é¡ºåº
<div tabindex="0">å¯èšç„¦</div>
<div tabindex="-1">åªèƒ½é€šè¿‡ JS èšç„¦</div>

// å½“å‰èšç„¦å…ƒç´ 
document.activeElement
```

### 4.3 äº‹ä»¶ï¼šchangeï¼Œinputï¼Œcutï¼Œcopyï¼Œpaste

```javascript
// change - å¤±ç„¦åå€¼æ”¹å˜æ—¶è§¦å‘
input.onchange = function() { };

// input - å€¼æ¯æ¬¡æ”¹å˜æ—¶è§¦å‘
input.oninput = function() { };

// å‰ªè´´æ¿äº‹ä»¶
elem.oncopy = function(event) {
  event.clipboardData.setData('text/plain', text);
  event.preventDefault();
};

elem.onpaste = function(event) {
  let text = event.clipboardData.getData('text/plain');
  event.preventDefault();
};
```

### 4.4 è¡¨å•ï¼šäº‹ä»¶å’Œæ–¹æ³• submit

```javascript
// æäº¤è¡¨å•
form.submit();

// äº‹ä»¶
form.onsubmit = function(event) {
  // éªŒè¯
  if (!valid) {
    event.preventDefault();
  }
};
```

---

## 5. åŠ è½½æ–‡æ¡£å’Œå…¶ä»–èµ„æº

### 5.1 é¡µé¢ç”Ÿå‘½å‘¨æœŸï¼šDOMContentLoadedï¼Œloadï¼Œbeforeunloadï¼Œunload

```javascript
// DOM æ„å»ºå®Œæˆ
document.addEventListener('DOMContentLoaded', function() {
  // DOM å·²å°±ç»ªï¼Œä½†å›¾ç‰‡å’Œæ ·å¼å¯èƒ½è¿˜åœ¨åŠ è½½
});

// é¡µé¢å®Œå…¨åŠ è½½
window.onload = function() {
  // æ‰€æœ‰èµ„æºå·²åŠ è½½
};

// ç”¨æˆ·ç¦»å¼€å‰
window.onbeforeunload = function() {
  return "ç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ"; // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
};

// ç”¨æˆ·ç¦»å¼€æ—¶
window.onunload = function() {
  navigator.sendBeacon(url, data); // å‘é€ç»Ÿè®¡æ•°æ®
};

// æ£€æŸ¥æ–‡æ¡£çŠ¶æ€
document.readyState; // "loading", "interactive", "complete"
document.onreadystatechange = function() { };
```

### 5.2 è„šæœ¬ï¼šasyncï¼Œdefer

```html
<!-- æ™®é€šè„šæœ¬ - é˜»å¡ HTML è§£æ -->
<script src="script.js"></script>

<!-- defer - åœ¨ DOMContentLoaded å‰æ‰§è¡Œï¼ŒæŒ‰é¡ºåº -->
<script defer src="script.js"></script>

<!-- async - åŠ è½½å®Œç«‹å³æ‰§è¡Œï¼Œä¸ä¿è¯é¡ºåº -->
<script async src="script.js"></script>

<!-- åŠ¨æ€è„šæœ¬ -->
<script>
let script = document.createElement('script');
script.src = "script.js";
script.async = false; // ä¿æŒé¡ºåº
document.body.append(script);
</script>
```

### 5.3 èµ„æºåŠ è½½ï¼šonload å’Œ onerror

```javascript
// è„šæœ¬åŠ è½½
let script = document.createElement('script');
script.src = "script.js";
script.onload = function() { /* åŠ è½½æˆåŠŸ */ };
script.onerror = function() { /* åŠ è½½å¤±è´¥ */ };

// å›¾ç‰‡åŠ è½½
let img = document.createElement('img');
img.src = "image.png";
img.onload = function() { };
img.onerror = function() { };

// è·¨åŸŸè„šæœ¬é”™è¯¯å¤„ç†
<script crossorigin="anonymous" src="..."></script>
```

---

## 6. æ‚é¡¹

### 6.1 Mutation observer

ç›‘è§† DOM å˜åŒ–ï¼š

```javascript
let observer = new MutationObserver(callback);

observer.observe(node, {
  childList: true,       // ç›‘è§†ç›´æ¥å­èŠ‚ç‚¹
  subtree: true,         // ç›‘è§†æ‰€æœ‰åä»£
  attributes: true,      // ç›‘è§†ç‰¹æ€§
  attributeFilter: ['class', 'style'], // ç›‘è§†ç‰¹å®šç‰¹æ€§
  characterData: true,   // ç›‘è§†æ–‡æœ¬å†…å®¹
  attributeOldValue: true,     // è®°å½•æ—§ç‰¹æ€§å€¼
  characterDataOldValue: true  // è®°å½•æ—§æ–‡æœ¬
});

function callback(mutationsList, observer) {
  for (let mutation of mutationsList) {
    mutation.type        // "childList", "attributes", "characterData"
    mutation.target      // å˜åŒ–å‘ç”Ÿçš„èŠ‚ç‚¹
    mutation.addedNodes  // æ·»åŠ çš„èŠ‚ç‚¹
    mutation.removedNodes // ç§»é™¤çš„èŠ‚ç‚¹
    mutation.attributeName // å˜åŒ–çš„ç‰¹æ€§å
    mutation.oldValue    // æ—§å€¼
  }
}

observer.disconnect(); // åœæ­¢ç›‘è§†
let records = observer.takeRecords(); // è·å–å¾…å¤„ç†è®°å½•
```

### 6.2 Selection å’Œ Range

**Range**ï¼šé€‰æ‹©æ–‡æ¡£çš„ä¸€éƒ¨åˆ†

```javascript
let range = new Range();
range.setStart(node, offset);
range.setEnd(node, offset);

// å¿«æ·æ–¹æ³•
range.setStartBefore(node);
range.setStartAfter(node);
range.setEndBefore(node);
range.setEndAfter(node);
range.selectNode(node);
range.selectNodeContents(node);
range.collapse(toStart);

// æ“ä½œ
range.cloneContents();   // å…‹éš†å†…å®¹
range.extractContents(); // æå–å†…å®¹
range.deleteContents();  // åˆ é™¤å†…å®¹
range.insertNode(node);  // æ’å…¥èŠ‚ç‚¹
```

**Selection**ï¼šç”¨æˆ·é€‰æ‹©çš„å†…å®¹

```javascript
let selection = document.getSelection();

selection.anchorNode     // é€‰æ‹©å¼€å§‹çš„èŠ‚ç‚¹
selection.anchorOffset   // é€‰æ‹©å¼€å§‹çš„åç§»
selection.focusNode      // é€‰æ‹©ç»“æŸçš„èŠ‚ç‚¹
selection.focusOffset    // é€‰æ‹©ç»“æŸçš„åç§»
selection.isCollapsed    // é€‰æ‹©æ˜¯å¦ä¸ºç©º
selection.rangeCount     // Range æ•°é‡

selection.getRangeAt(i)  // è·å–ç¬¬ i ä¸ª Range
selection.addRange(range)   // æ·»åŠ  Range
selection.removeRange(range) // ç§»é™¤ Range
selection.removeAllRanges() // æ¸…ç©ºé€‰æ‹©
selection.collapse(node, offset) // æŠ˜å é€‰æ‹©
selection.selectAllChildren(node) // é€‰æ‹©æ‰€æœ‰å­èŠ‚ç‚¹
selection.toString()     // è·å–é€‰ä¸­æ–‡æœ¬

// è¡¨å•å…ƒç´ é€‰æ‹©
input.select();
input.setSelectionRange(start, end, direction);
input.selectionStart;
input.selectionEnd;
input.selectionDirection;

// äº‹ä»¶
document.onselectionchange = function() { };
input.onselect = function() { };
```

### 6.3 äº‹ä»¶å¾ªç¯ï¼šå¾®ä»»åŠ¡å’Œå®ä»»åŠ¡

**äº‹ä»¶å¾ªç¯æœºåˆ¶**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      å®ä»»åŠ¡é˜Ÿåˆ—         â”‚ â† script, setTimeout, setInterval, I/O, UI rendering
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      å¾®ä»»åŠ¡é˜Ÿåˆ—         â”‚ â† Promise.then, queueMicrotask, MutationObserver
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ‰§è¡Œé¡ºåº**ï¼š
1. ä»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªä»»åŠ¡æ‰§è¡Œ
2. æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡
3. å¦‚æœ‰éœ€è¦ï¼Œè¿›è¡Œ UI æ¸²æŸ“
4. é‡å¤

```javascript
// æ·»åŠ å¾®ä»»åŠ¡
queueMicrotask(() => {
  // å¾®ä»»åŠ¡ä»£ç 
});

// ç¤ºä¾‹
console.log(1);

setTimeout(() => console.log(2), 0);

Promise.resolve()
  .then(() => console.log(3))
  .then(() => console.log(4));

console.log(5);

// è¾“å‡ºé¡ºåº: 1, 5, 3, 4, 2
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [ç°ä»£ JavaScript æ•™ç¨‹ - æµè§ˆå™¨éƒ¨åˆ†](https://zh.javascript.info/ui)
- [MDN Web APIs](https://developer.mozilla.org/zh-CN/docs/Web/API)
- [DOM è§„èŒƒ](https://dom.spec.whatwg.org/)

