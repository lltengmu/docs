# 计算机网络的分层结构



## 分层设计的思想

计算机之间传递信息，除了在两台计算机之间连接一条通路之外，还需要以下功能：

1. 发起通信的的计算机必须将数据通信的通路`激活`。“激活”是指发出一条`信令`，保证数据在这条通路上正确发送和接收。
2. 告诉网络如何识别接收数据的计算机。
3. 发起通信的计算机需查明接收数据的计算机是否已开机，并且已连接网络。
4. 发起通信的计算机必须知道，在对方的计算机的文件管理程序是否做好接收和存储文件的准备。
5. 若计算机的文件格式不兼容，则至少其中一台计算机应完成格式转化的功能。
6. 对出现的各种差错和意外事故，应当有可靠的措施保证数据传输的准确性。

`分层`思想将将庞大而复杂的问题，转化为若干较小的局部问题，而这些较小的局部问题就比较易于研究和处理。



## 三种常见的计算机网络体系结构

网络体系结构是计算机网络的各层及其协议的集合，就是这个计算机网络及其构件所应完成的功能的精确定义（不涉及实现）。实现是遵循这种体系结构的前提下，用何种硬件或软件完成这些功能的问题。

三种常见的结构：

+ **OSI 参考模型**:

  + 应用层：实现特定的网络应用。
  + 表示层： 解决不同主机上信息不一致的问题。（数据格式转换）
  + 会话层：管理进程间的会话（采用检查点机制，当通信失效时从检查点继续恢复通信）
  + 传输层：实现端到端通信（即实现进程到进程的通信，“端”指端口），包含以下功能：
    1. 复用和分用：发送端几个高层实体复用一条底层的连接，在接收端再进行分用。
    2. 其他功能：差错控制、流量控制、连接建立与释放、可靠传输数据管理
  + 网络层：把分组从源节点转发到目的节点，包含以下功能： 
    1. 路由选择：构造并维护路由表，决定分组到达目的节点的最佳路径
    2. 分组转发  ：将分组从合适的端口转发出去
    3. 拥塞控制：发现网络拥堵，采取措施缓解拥堵
    4. 网络互联：实现异构网络互联
    5. 其他功能：差错控制，流量控制，连接建立与释放、可靠传输管理
  + 数据链路层：确保相邻节点之间的链路逻辑上无差错。包含以下功能：1. 差错控制 2.流量控制
  + 物理层：实现相邻节点之间比特（0 或1）的传输 

+ **TCP/IP模型**：

  理念：如果某些应用需要使用数据转换、会话管理功能，就交给应用层的特定协议去实现。

  1. 应用层：实现特定的网络应用

  2. 传输层：复用和分用，差错控制、流量控制、连接建立与释放、可靠传输管理

  3. 网络层：路由选择，分组转发，拥塞控制，网际互联，差错控制，流量控制，连接管理，可靠传输管理。

  4. 网络接口层：实现相邻节点间的数据传输（为网络层传输“分组”）。但具体怎么传输不作规定。网络接口层为网络层传输“分组”。但`TCP/IP`并未具体描述网络接口层的功能、协议（交给网络设备商自由发挥）。

+ **五层模型**

  1. 应用层
  2. 传输层
  3. 网络层
  4. 数据链路层
  5. 物理层

## 各层之间的关系

**从水平视角看**：

实体：在计算机网络的分层结构中，第 n 层中的活动元素（软件 + 硬件），通常称为第 n 层实体。不同机器上的同一层称为 `对等层`，同一层的实体称为`对等实体`。

协议：即 网络协议`Network Protocl`，是控制对等实体之间进行通信的规则的集合，是水平的。

图示：

![The-relationship–between-hierarchical-structures](/Users/eddie/Documents/code/docs/docs/web-development-basics/computer-network/概述/images/The-relationship–between-hierarchical-structures.png)

**从垂直视角看：**

接口：即同一节点内相邻的实体交换信息的逻辑接口，也称为服务访问节点（Service Access Point,SAP）。

服务：服务是指下层为紧邻的上层提供的功能调用，它是垂直的。

图示：

![Vertical-relationship-of-hierarchical-structure](/Users/eddie/Documents/code/docs/docs/web-development-basics/computer-network/概述/images/Vertical-relationship-of-hierarchical-structure.png)



## PDU、SDU、PCI 的概念

+ 协议数据单元（PDU）：对等层次之间传送的数据单位，第 n 层的PDU 记为 n-PDU。
+ 服务数据单元（SDU）：为完成上一层实体所要求的功能而传送的数据。第 n 层的SDU 记为 n-SDU。
+ 协议控制单元（PCI）：控制协议操作的信息。第 n 层的PCI记为 n-PCI。

三者之间的关系：`n-SDU` + `n-PCI` = `n-PDU` = `(n-1)-SUD`

图示：

![The-concept-of-PDU-SDU-PCI](/Users/eddie/Documents/code/docs/docs/web-development-basics/computer-network/概述/images/The-concept-of-PDU-SDU-PCI.png)



## 协议三要素

即 网络协议`Network Protocol`，是控制对等实体之间进行通信的规则的集合，是水平的。

协议由`语法`、`语义`和`同步`三部分组成（协议的三要素）:

+ 语法：数据与控制信息的格式，例如，协议控制信息（首部）部分占几个字节、每个字节是什么含义，协议的数据部分最多由多少字节。
+ 语义：即需要发出何种控制信息，完成何种动作及做出何种应答方式。例如，协议中需要明确规定：发送完数据之后，接受方是否需要“应答”。以及应答的种类有哪些。（如：传输成功、传输失败）。 
+ 同步（时序）：之心各种操作的条件，时序关系等，即时间实现顺序的详细说明。例如，发送方发完数据后，接受方需要立即应答。如果发送方在10秒内未收到“传输成功”应答，则发送方会再次发送数据。 